<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Building this Site &middot; arapaima.uk
    
  </title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
 
  
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
  if (window.location.hostname == "localhost")
       return;

    var u="//arapaima-piwik.azurewebsites.net/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//arapaima-piwik.azurewebsites.net/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>

</head>


  <body class="theme-base-0d">

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>I'm Gavin Campbell, a database developer interested in Continuous Delivery, functional programming, and cricket.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item " href="/post">Posts</a>

    
    
      
    
      
    
      
    
      
    
      
        <a class="sidebar-nav-item " href="http://arapaima.uk/fixed/About/">Get in touch</a>
      
    
      
        <a class="sidebar-nav-item  active " href="http://arapaima.uk/fixed/BlogSetup/">Building this Site</a>
      
    
    <a class="sidebar-nav-item " href="/index.xml">RSS</a>
    

  </nav>
  
  <div class = "sidebar-item">
  <p> <a href = "https://travis-ci.org/arapaima-uk/source.arapaima-uk.github.io">
      <img src = "https://travis-ci.org/arapaima-uk/source.arapaima-uk.github.io.svg?branch=master" alt = "Travis CI Build Status" title = "Travis CI Build Status">
      </a>
    </p>
  </div>
  <div class="sidebar-item">
    <p><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Content on arapaima.uk</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://arapaima.uk" property="cc:attributionName" rel="cc:attributionURL">Gavin Campbell, Arapaima Ltd</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">arapaima.uk</a>
            <small>Data, Databases, Delivery</small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="page">
  <h1 class="page-title">Building this Site</h1>


    <div id="toc" >
    <nav id="TableOfContents">
<ul>
<li><a href="#overview">Overview</a>
<ul>
<li><a href="#github-setup">Github setup</a></li>
<li><a href="#hugo">Hugo</a>
<ul>
<li><a href="#getting-hugo">Getting Hugo</a></li>
<li><a href="#scaffolding-the-site">Scaffolding the site</a></li>
<li><a href="#themes">Themes</a>
<ul>
<li><a href="#customising-the-theme">Customising the Theme</a></li>
</ul></li>
<li><a href="#static-pages">Static Pages</a></li>
<li><a href="#a-first-post">A First Post</a></li>
<li><a href="#syntax-highlighting">Syntax highlighting</a></li>
</ul></li>
<li><a href="#github">Github</a></li>
<li><a href="#travis-ci">Travis CI</a>
<ul>
<li><a href="#build">Build</a></li>
<li><a href="#deploy">Deploy</a></li>
<li><a href="#dns-stuff">DNS stuff</a></li>
</ul></li>
</ul></li>
<li><a href="#profit">Profit!</a></li>
</ul>
</nav>
    </div>
  

  

<h1 id="overview">Overview</h1>

<p>This site is created using the <a href="http://gohugo.io/">Hugo</a> static site generator and hosted on <a href="https://pages.github.com/">GitHub Pages</a>. It is built and deployed with <a href="https://travis-ci.org/">Travis CI</a>, meaning that changes and additions are pushed to the public website as soon as they are committed. For now this is an <a href="http://dilbert.com/strip/2016-06-21">MVP</a>, I&rsquo;ll add more moving parts and update this page accordingly as time goes on. There are a couple of features right &ldquo;out of the box&rdquo; such as drafts and scheduled posts.</p>

<h2 id="github-setup">Github setup</h2>

<p>To publish a personal or organizational site on GitHub Pages, all that is required is to create a repo named <em>&lt;username&gt;</em>.github.io, where <em>&lt;username&gt;</em> is your GitHub user name or organization name. This site is for the organization arapaima-uk, so the repo is named <a href="https://arapaima-uk.github.io">arapaima-uk.github.io</a>, which also happens to be a url for the home page of the site. You can see the repository details at <a href="https://github.com/arapaima-uk/arapaima-uk.github.io">https://github.com/arapaima-uk/arapaima-uk.github.io</a>. Now, how this works is that the contents of the master branch of this &ldquo;special&rdquo; repo are served as a static website. Since static site generators work by transforming some input files (markdown, reStructuredText, etc. ) into a static website (html, javascript, css, etc.) I decided to create a separate repo to hold the &ldquo;source code&rdquo; of the site, and use Travis CI to &ldquo;build&rdquo; and deploy the output to the master branch of the <a href="https://arapaima-uk.github.io">arapaima-uk.github.io</a> repo. The &ldquo;source&rdquo; repo is <a href="https://github.com/arapaima-uk/source.arapaima-uk.github.io">source.arapaima-uk.github.io</a>. Note that this isn&rsquo;t a &ldquo;special&rdquo; repo, there&rsquo;s no page being served at <a href="http://source.arapaima-uk.github.io/">http://source.arapaima-uk.github.io/</a>.</p>

<h2 id="hugo">Hugo</h2>

<h3 id="getting-hugo">Getting Hugo</h3>

<p>I started by downloading the latest release (v0.17) from <a href="https://github.com/spf13/hugo/releases">hugo&rsquo;s github releases page</a>. I followed the <a href="https://gohugo.io/tutorials/installing-on-windows/">instructions here</a> to create the folders <code>D:\Hugo\bin</code> and <code>D:\Hugo\Sites</code>, and extracted the contents of the downloaded zip file to <code>D:\Hugo\bin</code>. I also renamed <code>hugo_0.17_windows_amd64.exe</code> to <code>hugo.exe</code>. Running <code>hugo help</code> from the bin folder is the easiest way to check that everything is working. Optionally, add the <code>hugo\bin</code> folder to your system path to avoid having to type the full path to the executable every time.</p>

<h3 id="scaffolding-the-site">Scaffolding the site</h3>

<p>This is as easy as running <code>hugo new site source.arapaima-uk.github.io</code> from within our <code>hugo\Sites</code> folder. All being well, this will result in the following output:</p>

<pre><code>$ ..\bin\hugo new site source.arapaima-uk.github.io
Congratulations! Your new Hugo site is created in &quot;D:\\Hugo\\Sites\\source.arapaima-uk.github.io&quot;.

Just a few more steps and you're ready to go:

1. Download a theme into the same-named folder.
   Choose a theme from https://themes.gohugo.io/, or
   create your own with the &quot;hugo new theme &lt;THEMENAME&gt;&quot; command.
2. Perhaps you want to add some content. You can add single files
   with &quot;hugo new &lt;SECTIONNAME&gt;/&lt;FILENAME&gt;.&lt;FORMAT&gt;&quot;.
3. Start the built-in live server via &quot;hugo server&quot;.

Visit https://gohugo.io/ for quickstart guide and full documentation.
</code></pre>

<h3 id="themes">Themes</h3>

<p>After much consideration, I settled on the <a href="http://themes.gohugo.io/lanyon/">Lanyon</a> theme for Hugo. Installing a theme is as simple as cloning the relevant repo into the <code>themes</code> folder under the root of your site.</p>

<pre><code>D:\Hugo\Sites\source.arapaima-uk.github.io\themes
$ git clone https://github.com/tummychow/lanyon-hugo.git
Cloning into 'lanyon-hugo'...
remote: Counting objects: 320, done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 320 (delta 0), reused 0 (delta 0), pack-reused 317 eceiving objects:  91% (292/320)
Receiving objects: 100% (320/320), 283.68 KiB | 0 bytes/s, done.
Resolving deltas: 100% (103/103), done.
Checking connectivity... done.
</code></pre>

<p>You can specify a theme with the <code>-t</code> flag when running <code>hugo</code> (to generate your site) or <code>hugo server</code> (to preview the site on a local webserver) at the command line. Given that I had only downloaded the one theme, I decided to lock in this choice by adding the line <code>theme = &quot;lanyon-hugo&quot;</code> to the <code>config.toml</code> file at the root of the site.</p>

<p>You should now be able to run <code>hugo server</code> from the root of your site, and view the (empty) site on <a href="http://localhost:1313">http://localhost:1313</a></p>

<h4 id="customising-the-theme">Customising the Theme</h4>

<p>Customising themes in Hugo works by adding files to the root, or &ldquo;working directory&rdquo; of your site that override their counterparts inside the theme folder itself. This means that in order to override the favicons stored at <code>arapaima-uk.github.io\themes\lanyon-hugo\static\assets</code> , we create an <code>assets</code> folder under the <code>source.arapaima-uk.github.io\static</code> folder in our site and add our own <code>favicon.ico</code> as well as the all-important <code>apple-touch-icon-144-precomposed.png</code> (I have no idea what this does).</p>

<p>Likewise, we can override the pre-canned sidebar content by copying the file <code>sidebar.html</code> from  <code>\source.arapaima-uk.github.io\themes\lanyon-hugo\layouts\partials</code> to our own <code>\arapaima-uk.github.io\layouts\partials</code> folder. I made quite a few changes to this file, you can check them out directly on github <a href="https://github.com/arapaima-uk/source.arapaima-uk.github.io/blob/master/layouts/partials/sidebar.html">here</a>.</p>

<p>Now is a good time to have another look at the <code>config.toml</code> file that defines much of the behaviour of the site. The first section holds a few site-wide configuration items, whilst the <code>[params]</code> section holds variables that can be used by the templates that make up our theme. (<em>some</em> changes in this file don&rsquo;t get read until the site is rebuilt, so if you are using <code>hugo server</code> to follow along you <em>may</em> need to restart it.)</p>

<pre><code>languageCode = &quot;en-gb&quot;
baseurl = &quot;http://arapaima.uk/&quot;
title = &quot;Arapaima (UK)&quot;
theme = &quot;lanyon-hugo&quot;
[params]
    DateForm =  &quot;2006-01-02&quot;
    Title = &quot;arapaima.uk&quot;
    Tagline =  &quot;Data, Databases, Delivery&quot;
    Author  = &quot;Gavin Campbell&quot;
</code></pre>

<h3 id="static-pages">Static Pages</h3>

<p>These are often used for &ldquo;About me&rdquo; or similar, I don&rsquo;t have one of those yet so we&rsquo;ll make do with the <a href="https://raw.githubusercontent.com/arapaima-uk/source.arapaima-uk.github.io/master/content/fixed/BlogSetup.md">file that contains the source for this article</a>. This is a markdown file called <code>BlogSetup.md</code>, that goes in the <code>\content\fixed\</code> folder of our working directory. There is a bit of metadata at the top, enclosed by plus signs, again in TOML format. The interesting items here are <code>sidebar=&quot;true&quot;</code>, which will create a link in the sidebar for this page, and <code>weight = &quot;10&quot;</code>, which sets the relative ordering of sidebar items (heaviest weights sink to the bottom.)</p>

<pre><code>+++
title = &quot;Building this Site&quot;
sidebar =  true
weight =  &quot;10&quot;
+++
</code></pre>

<h3 id="a-first-post">A First Post</h3>

<p>This is just a <a href="https://raw.githubusercontent.com/arapaima-uk/source.arapaima-uk.github.io/master/content/post/2016-10-13-verschlimmbesserung.md">markdown file</a> with a bit of front matter (title, date) that goes in the <code>/content/post</code> folder.</p>

<h3 id="syntax-highlighting">Syntax highlighting</h3>

<p>For this site, we&rsquo;ll use server-side (i.e. pre-processed) syntax highlighting with <a href="http://pygments.org/">Pygments</a>. This requires installing <a href="https://www.python.org/downloads/">Python</a>, then running <code>pip install pygments</code> to install the module. You can run <code>pygmentize -h</code> to make sure everything is working, and that Hugo is able to find the command in your path. You can list the installed pygments styles with <code>pygmentize -L styles</code>. This turned out to be important, as the hugo default (monokai) turned out to be almost invisble against the background created by the lanyon theme. I decided on the &ldquo;lovelace&rdquo; theme, and set this by adding</p>

<pre><code>PygmentsCodeFences = &quot;true&quot;
PygmentsStyle = &quot;lovelace&quot;
</code></pre>

<p>to the <code>config.toml</code> file. The <code>PygmentsCodeFences</code> line allows specifying a style in markdown directly after the <code>```</code> , for example the following block is styled <code>```c</code>.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #289870">#include</span> <span style="color: #888888; font-style: italic">&lt;stdio.h&gt;</span><span style="color: #289870"></span>
main<span style="color: #888888">()</span>
<span style="color: #888888">{</span>
    printf<span style="color: #888888">(</span><span style="color: #b83838">&quot;Hello, world!</span><span style="color: #709030">\n</span><span style="color: #b83838">&quot;</span><span style="color: #888888">);</span>
<span style="color: #888888">}</span>
</pre></div>

<h2 id="github">Github</h2>

<p>We&rsquo;ve got enough for a working site, time for a first commit. Before we start, we&rsquo;ll add a <code>.gitignore</code> file to the <code>public</code> folder of the site containing the following lines:</p>

<pre><code>*
*/
!.gitignore
</code></pre>

<p>Since this is where the generated output ends up, we don&rsquo;t want to track the contents of this folder in our source repo on Github, the only place we need these files is on the public site itself. The three lines are telling git to ignore, respectively, all files in this folder, all files in subfolders of this folder, but not this <code>.gitignore</code> file itself.</p>

<p>Now we just need to <code>git init</code>, hook our local repo up to Github with</p>

<pre><code>git remote add origin https://github.com/arapaima-uk/source.arapaima-uk.github.io.git
git branch --set-upstream master origin/master
git add .
git commit -m &quot;Witty commit message goes here&quot;
git push
</code></pre>

<h2 id="travis-ci">Travis CI</h2>

<p>After signing into Travis CI with Github credentials, you need to flick the switch to enable Travis to access your source repository. There are a couple of extra setting hidden behind the little cog in the list of repos, notably &ldquo;Build Only if .travis.yml is present&rdquo; (set this to &ldquo;on&rdquo;), &ldquo;Build Pushes&rdquo; (set to &ldquo;on&rdquo;), and &ldquo;Build Pull Requests (I set this to &ldquo;off&rdquo;. I&rsquo;m not taking pull requests right now&hellip;)</p>

<p>Next, we need to create a <code>.travis.yml</code> file in the root of the source repository.</p>

<h3 id="build">Build</h3>

<p>I started with the following lines in mine:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>sudo<span style="color: #888888">:</span> required
install<span style="color: #888888">:</span> 
  <span style="color: #888888">-</span> wget https://github.com/spf13/hugo/releases/download/v0.17/hugo_0.17-64bit.deb
  <span style="color: #888888">-</span> sudo dpkg -i hugo_0.17-64bit.deb
  <span style="color: #888888">-</span> sudo pip install Pygments
   
script<span style="color: #888888">:</span>
  <span style="color: #888888">-</span> hugo -v
</pre></div>

<p>This will download and install pygments and hugo, then call the <code>hugo</code> executable to build our site. One detail here is that I&rsquo;m fetching a specific version of hugo; I initially tried fetching the latest with <code>go get</code>, but this seemed to result in compatibility nightmares.</p>

<p>Now, when we commit and push the repo with the <code>.travis.yml</code> file included, Travis will fetch our code and build our site. If this step isn&rsquo;t working, there&rsquo;s not much point continuing, so take a moment to ensure that everything is green. You will observe that Travis isn&rsquo;t all that fast; I got a car for free once and it wasn&rsquo;t all that fast either.</p>

<h3 id="deploy">Deploy</h3>

<p>Most of the instructions in this part are based on <a href="http://www.steveklabnik.com/automatically_update_github_pages_with_travis_example/">this</a> article. There are a few security hoops to jump through here. You need to create a Github Access Token <a href="https://github.com/settings/tokens/new">here</a>, which Travis will use to authenticate to the Github Pages repo. The scope of the token needs to be &ldquo;repo&rdquo;. You need to paste this into another window straight away, as Github will only show it to you once.</p>

<p>This needs to be pasted into an environment variable named GH_TOKEN in the settings of your repo on Travis CI, there is a switch for &ldquo;Display value in build log&rdquo;, which you want to have set to &ldquo;off&rdquo;.</p>

<p>The next step uses the Travis command line ruby gem, you&rsquo;ll need to install ruby followed by <code>gem install travis</code> if you haven&rsquo;t got this already. If you do this from the root directory of your repo, the key will be automatically added to your <code>.travis.yml</code> file.</p>

<pre><code>travis encrypt -r username/reponame GH_TOKEN=[the token you created before] --add
</code></pre>

<p>Finally we need a deploy script to copy the files from Travis back to the Github pages repo. The following script, in the root of the repo, does the following:</p>

<ul>
<li>Saves the hash at the head of the source repo to use in the commit message for the target</li>
<li>Deletes the <code>.gitignore</code> file so that our content pages don&rsquo;t get ignored when we push to the new site (ask me how I figure this out&hellip;)</li>
<li>Creates a <em>new</em> git repo to hook up to our target.</li>
<li>Writes the CNAME file needed by GitHub pages to redirect our <code>.github.io</code> name to our &ldquo;real&rdquo; domain name. If this is currently pointing somewhere else at your DNS provider, your site will be hosed after you do this as your <code>github.io</code> name will redirect your &ldquo;real&rdquo; name, which is still pointing somewhere else! If you encounter problems here it&rsquo;s probably best to delete this line until everything is working again.</li>
<li>Touches every file in the repo so they look &ldquo;new&rdquo;.</li>
<li>Pushes the pages to our GH Pages Repo</li>
</ul>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #287088; font-style: italic">#!/usr/bin/env bash</span>

<span style="color: #b04040">rev</span><span style="color: #666666">=</span><span style="color: #2838b0">$(</span>git rev-parse --short HEAD<span style="color: #2838b0">)</span>

<span style="color: #388038">cd</span> public
rm .gitignore

git init
git config user.name <span style="color: #b83838">&quot;Travis CI&quot;</span>
git config user.email <span style="color: #b83838">&quot;travis@arapaima.uk&quot;</span>

git remote add upstream <span style="color: #b83838">&quot;https://</span><span style="color: #b04040">$GH_TOKEN</span><span style="color: #b83838">@github.com/arapaima-uk/arapaima-uk.github.io.git&quot;</span>
git fetch upstream
git reset upstream/master

<span style="color: #388038">echo</span> <span style="color: #b83838">&quot;arapaima.uk&quot;</span> &gt; CNAME

touch .

git add -A .
git commit -m <span style="color: #b83838">&quot;rebuild pages at </span><span style="color: #b83838; text-decoration: underline">${</span><span style="color: #b04040">rev</span><span style="color: #b83838; text-decoration: underline">}</span><span style="color: #b83838">&quot;</span>
git push -q upstream HEAD:master
</pre></div>

<h3 id="dns-stuff">DNS stuff</h3>

<p>If you&rsquo;re using a custom domain, now is a good time to log into your DNS provider and follow the steps <a href="https://help.github.com/articles/using-a-custom-domain-with-github-pages/">here</a>. It took a while for my ISP to get the change, clearly their DNS servers don&rsquo;t get up as early on a Saturday as I do.</p>

<h1 id="profit">Profit!</h1>

<p>Having got to here, we definitely want to have one of those build status buttons in the sidebar of our site.</p>

<p>This can be done by adding the following to the template, substituting the name of your source repo (not the Github Pages one! as appropriate).</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>  <span style="color: #888888">&lt;</span><span style="color: #2838b0">div</span> <span style="color: #388038">class </span><span style="color: #666666">=</span> <span style="color: #b83838">&quot;sidebar-item&quot;</span><span style="color: #888888">&gt;</span>
  <span style="color: #888888">&lt;</span><span style="color: #2838b0">p</span><span style="color: #888888">&gt;</span> <span style="color: #888888">&lt;</span><span style="color: #2838b0">a</span> <span style="color: #388038">href </span><span style="color: #666666">=</span> <span style="color: #b83838">&quot;https://travis-ci.org/arapaima-uk/source.arapaima-uk.github.io&quot;</span><span style="color: #888888">&gt;</span>
      <span style="color: #888888">&lt;</span><span style="color: #2838b0">img</span> <span style="color: #388038">src </span><span style="color: #666666">=</span> <span style="color: #b83838">&quot;https://travis-ci.org/arapaima-uk/source.arapaima-uk.github.io.svg?branch=master&quot;</span> <span style="color: #388038">alt </span><span style="color: #666666">=</span> <span style="color: #b83838">&quot;Travis CI Build Status&quot;</span> <span style="color: #388038">title </span><span style="color: #666666">=</span> <span style="color: #b83838">&quot;Travis CI Build Status&quot;</span><span style="color: #888888">&gt;</span>
      <span style="color: #888888">&lt;/</span><span style="color: #2838b0">a</span><span style="color: #888888">&gt;</span>
    <span style="color: #888888">&lt;/</span><span style="color: #2838b0">p</span><span style="color: #888888">&gt;</span>
  <span style="color: #888888">&lt;/</span><span style="color: #2838b0">div</span><span style="color: #888888">&gt;</span>
</pre></div>

<p>In fact, I think I&rsquo;ll have one here too: <a href="https://travis-ci.org/arapaima-uk/source.arapaima-uk.github.io"><img src="https://travis-ci.org/arapaima-uk/source.arapaima-uk.github.io.svg?branch=master" alt="Build Status" /></a> You can get these links in various formats by clicking on the build status icon in the home page of your repo on Travis.</p>

</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>

